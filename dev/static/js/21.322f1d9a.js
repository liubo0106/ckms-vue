(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{"Ib/9":function(e,t,a){"use strict";a.r(t);var r=a("TsPW"),i={name:"edit-user-manage",data:function(){var e=this;return{dialogTreeFormVisible:!1,dialogTreeTitle:"新增打包明细",tableData:null,dialogTitle:"",dialogFormVisible:!1,formLabelWidth:"80px",dialogForm:{serialNo:"",name:"",standard:"",number:"",price:"",id:"",productInfoId:""},id:"",headers:{sessionId:sessionStorage.getItem("sessionId")},productList:[],param:{pageSize:-1},param2:{pid:""},standardParam:{type:"单位"},pathIds:sessionStorage.getItem("pathIds"),props:{checkStrictly:!0,value:"id",label:"name",children:"children"},deptList:[],deptId:sessionStorage.getItem("deptId"),saveLoading:!1,editForm:{name:"",standard:"",serialNo:"",flag:"staff",post:"",price:"",deptArray:[],safeStock:0,multiple:1},rules:{name:[{required:!0,message:"请输入打包名称",trigger:"blur"},{min:1,max:100,message:"长度在 1 到 100 个字",trigger:"blur"}],serialNo:[{required:!0,message:"请输入打包编号",trigger:"blur"},{min:1,max:50,message:"长度在 1 到 50 个字",trigger:"blur"}],number:[{required:!0,message:"请输入",trigger:"blur"},{min:1,max:50,message:"长度在 1 到 15 个字",trigger:"blur"}],deptArray:[{type:"array",message:"请选择打包分类",trigger:"change"},{validator:function(t,a,r){"company"==e.editForm.flag?r():a&&a.length>0?r():r(new Error("请选择打包分类"))},trigger:"blur"}]},standardDataDicList:[],searchTreeForm:{name:"",serialNo:""},tableTreeData:null,paramTree:{name:"",pageNo:1,pageSize:10,deptId:"",checkChild:"all",serialNo:"",categoryId:"",isDelete:1},totalTreeNum:0,orgTreeData:[],defaultProps:{children:"children",label:"name"},total:0}},computed:{Price:function(){if(null!=this.tableData){for(var e=0,t=0;t<this.tableData.length;t++)if(null!=this.tableData[t].price){var a=this.tableData[t];e+=a.costPrice*(a.number/a.netYield)}return e}}},methods:{handleNodeClick:function(e){this.searchTreeForm.name="",this.paramTree.name="",this.paramTree.categoryId="","0"==e.id||(this.paramTree.categoryId=e.id),this.paramTree.pageNo=1,this.getTreeAjaxPage()},onSearchTree:function(){this.paramTree.pageNo=1,this.paramTree.serialNo=this.searchTreeForm.serialNo,this.paramTree.name=this.searchTreeForm.name,this.getTreeAjaxPage()},handleCurrentChangeTree:function(e){this.paramTree.pageNo=e,this.getTreeAjaxPage()},getTreeAjaxPage:function(){var e=this;Object(r.Md)(e.paramTree).then(function(t){if(200==t.status){var a=t.data.items;a&&a.length>0?(e.tableTreeData=a,e.totalTreeNum=parseInt(t.data.totalNum)):(e.tableTreeData=[],e.totalTreeNum=0)}})},getTreeAjaxList:function(){var e=this;Object(r.Ld)({}).then(function(t){if(200==t.status){var a=t.data;a&&a.length>0?e.orgTreeData=a:e.orgTreeData=[]}})},handleClickTreeAdd:function(e,t){var a,i=this;a={id:"",standard:t.standard,number:this.tableTreeData[e].number,price:t.price,productInfoId:t.id,packInfoId:i.id,serialNo:t.serialNo,name:t.name},Object(r.bd)(a).then(function(e){200==e.status?i.$message({type:"success",message:"操作成功!",duration:300,onClose:function(){i.saveLoading=!1,i.getAjaxList()}}):(i.saveLoading=!1,i.$message({type:"error",message:e.msg}))})},getAjaxStandardDataDic:function(){var e=this;Object(r.ze)(e.standardParam).then(function(t){if(200==t.status){var a=t.data;a&&a.length>0?e.standardDataDicList=a:e.standardDataDicList=[]}})},changeProduct:function(e){var t;t=this.productList.find(function(t){return t.id===e}),this.dialogForm.standard=t.standard,this.dialogForm.price=t.price},handleClickDetail:function(e,t,a){var i=this;"delete"==a?i.$confirm("真的删除该行数据么, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var e={id:t.id};Object(r.P)(e).then(function(e){200==e.status?i.$message({type:"success",message:"删除成功!",duration:300,onClose:function(){i.getAjaxList()}}):i.$message({type:"error",message:e.msg})})}).catch(function(){i.$message({type:"info",message:"已取消删除"})}):"add"==a?(this.getTreeAjaxPage(),this.getTreeAjaxList(),this.dialogTreeFormVisible=!0):"edit"==a&&i.addOrg("edit",t)},addOrg:function(e,t){this.dialogFormVisible=!0,"add"==e?(this.disabled=!1,this.dialogTitle="新增订单明细",this.dialogForm.standard="",this.dialogForm.number="",this.dialogForm.id="",this.dialogForm.price=0,this.dialogForm.productInfoId=""):(this.disabled=!this.disabled,this.dialogTitle="编辑打包明细",this.dialogForm.standard=t.standard,this.dialogForm.serialNo=t.serialNo,this.dialogForm.name=t.name,this.dialogForm.id=t.id,this.dialogForm.number=t.number,this.dialogForm.price=t.price,this.dialogForm.productInfoId=t.productInfoId)},dialogFormAdd:function(e){var t,a=this;t={id:this.dialogForm.id,standard:this.dialogForm.standard,number:this.dialogForm.number,price:this.dialogForm.price,productInfoId:this.dialogForm.productInfoId,name:this.dialogForm.name,serialNo:this.dialogForm.serialNo,salesOrderId:a.id,type:this.dialogForm.type},this.$refs[e].validate(function(e){if(!e)return!1;a.saveLoading=!0,Object(r.bd)(t).then(function(e){200==e.status?a.$message({type:"success",message:"操作成功!",duration:300,onClose:function(){a.saveLoading=!1,a.dialogFormVisible=!1,a.getAjaxList()}}):(a.saveLoading=!1,a.$message({type:"error",message:e.msg}))})})},getAjaxList:function(){var e=this;Object(r.Db)(e.param2).then(function(t){e.tableData=[];var a=t.data;a&&a.length>0?e.tableData=a:e.tableData=[]})},getAjaxProduct:function(){var e=this;Object(r.Md)(e.param).then(function(t){if(200==t.status){var a=t.data.items;a&&a.length>0?e.productList=a:e.productList=[]}})},goBack:function(){this.$router.push({path:"/groupManage"})},getTreeGroupAjaxList:function(){var e=this;Object(r.Bd)({}).then(function(t){var a=t.data;a&&(a&&a.length>0?e.deptList=a:e.deptList=[])})},getAjaxGroupInfo:function(){var e=this,t=this;Object(r.ob)({id:this.id}).then(function(a){var r=a.data;if(r){t.editForm.name=r.name,t.editForm.spec=r.spec,t.editForm.serialNo=r.serialNo,t.editForm.price=r.price,t.editForm.standard=r.standard,t.editForm.safeStock=r.safeStock,t.editForm.multiple=r.multiple;var i=r.strArray;i&&(t.editForm.deptArray=i.length>0?i.split(","):[]),r.flag&&(t.editForm.flag=r.flag)}else e.$message({message:"请求异常",type:"error"})})},submitForm:function(e){var t=this,a=this;this.$refs[e].validate(function(e){if(!e)return!1;a.saveLoading=!0;var i=a.editForm.deptArray,l={packCategoryId:i.length>0?i[i.length-1].toString():"",name:a.editForm.name,spec:a.editForm.spec,serialNo:a.editForm.serialNo,price:a.editForm.price,id:a.id,standard:a.editForm.standard,safeStock:a.editForm.safeStock,multiple:a.editForm.multiple,strArray:i.length>0?i.toString():""};Object(r.Mc)(l).then(function(e){if(400==e.status)return t.$message({type:"error",message:e.msg,duration:1e3}),a.saveLoading=!1,!1;t.$message({type:"success",message:"操作成功!",duration:300,onClose:function(){sessionStorage.setItem("groupId",e.data.id),a.id=e.data.id,a.param2.pid=e.data.id,a.getAjaxGroupInfo(),a.getAjaxList(),a.saveLoading=!1}})})})}},filters:{substr:function(e){if(null!=e)return e.toFixed(4)}},beforeMount:function(){var e=sessionStorage.getItem("groupId");e&&(this.id=e,this.param2.pid=e,this.getAjaxGroupInfo(),this.getAjaxList(),this.pathIds&&this.pathIds.length>0&&(this.editForm.deptArray=this.pathIds.length>0?this.pathIds.split(","):[])),this.getAjaxProduct(),this.getTreeGroupAjaxList(),this.getAjaxStandardDataDic()}},l=(a("Pr7a"),a("KHd+")),o=Object(l.a)(i,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",[a("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[a("el-breadcrumb-item",{attrs:{to:{path:"/groupManage"}}},[e._v("打包管理")]),e._v(" "),a("el-breadcrumb-item",[e._v(e._s(""==e.id?"新增":"编辑"))])],1),e._v(" "),a("div",{staticClass:"contentBody"},[a("el-form",{ref:"editForm",staticClass:"demo-ruleForm",attrs:{model:e.editForm,rules:e.rules,"label-width":"110px"}},[a("el-form-item",{attrs:{label:"打包编号",prop:"serialNo"}},[a("el-input",{attrs:{placeholder:"请输入",maxlength:50},model:{value:e.editForm.serialNo,callback:function(t){e.$set(e.editForm,"serialNo",t)},expression:"editForm.serialNo"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"打包名称",prop:"name"}},[a("el-input",{attrs:{placeholder:"请输入",maxlength:50},model:{value:e.editForm.name,callback:function(t){e.$set(e.editForm,"name",t)},expression:"editForm.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"打包分类",prop:"deptArray"}},[a("div",{attrs:{slot:"label"},slot:"label"},[a("span",{directives:[{name:"show",rawName:"v-show",value:"company"!=e.editForm.flag,expression:"editForm.flag != 'company'"}],staticClass:"red-span",staticStyle:{color:"#F56C6C"}},[e._v("*")]),e._v("打包分类")]),e._v(" "),[a("el-cascader",{staticClass:"self-cascader-width",attrs:{filterable:"",clearable:!0,props:e.props,placeholder:"请选择","change-on-select":"",options:e.deptList},model:{value:e.editForm.deptArray,callback:function(t){e.$set(e.editForm,"deptArray",t)},expression:"editForm.deptArray"}})]],2),e._v(" "),a("el-form-item",{attrs:{label:"成本价",prop:"price"}},[a("el-input-number",{attrs:{size:"medium",precision:2,disabled:!0,value:e.Price,min:0}})],1),e._v(" "),a("el-form-item",{attrs:{label:"安全库存",prop:"safeStock"}},[a("el-input-number",{attrs:{size:"medium",precision:2,min:0,max:999999999,step:1},model:{value:e.editForm.safeStock,callback:function(t){e.$set(e.editForm,"safeStock",t)},expression:"editForm.safeStock"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"单位",prop:"standard"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.editForm.standard,callback:function(t){e.$set(e.editForm,"standard",t)},expression:"editForm.standard"}},e._l(e.standardDataDicList,function(e){return a("el-option",{attrs:{label:e.name,value:e.name}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"出单倍数",prop:"multiple"}},[a("el-input-number",{attrs:{min:1,max:9999999,label:""},model:{value:e.editForm.multiple,callback:function(t){e.$set(e.editForm,"multiple",t)},expression:"editForm.multiple"}})],1),e._v(" "),a("el-form-item",[a("el-button",{staticStyle:{"background-color":"#35B178","border-color":"#35B178"},attrs:{type:"primary",loading:e.saveLoading},on:{click:function(t){return e.submitForm("editForm")}}},[e._v("提交")]),e._v(" "),a("el-button",{on:{click:function(t){return e.goBack()}}},[e._v("返回")])],1)],1),e._v(" "),e.id?a("div",{staticClass:"contentBody"},[a("el-form",{staticClass:"demo-form-inline",attrs:{"label-width":"60px"}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:4}},[a("el-form-item",{attrs:{"label-width":"0"}},[a("el-button",{attrs:{icon:"el-icon-plus",circle:""},on:{click:function(t){return e.handleClickDetail("","","add")}}})],1)],1)],1)],1),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:""}},[a("el-table-column",{attrs:{align:"center","header-align":"center",type:"index",label:"序号",width:"80"}}),e._v(" "),a("el-table-column",{attrs:{align:"center","header-align":"center",prop:"serialNo",label:"原料编号"}}),e._v(" "),a("el-table-column",{attrs:{align:"center","header-align":"center",prop:"name",label:"原料名称"}}),e._v(" "),a("el-table-column",{attrs:{align:"center","header-align":"center",prop:"standard",label:"单位"}}),e._v(" "),a("el-table-column",{attrs:{align:"center","header-align":"center",prop:"costPrice",label:"采购单价"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                        ￥"+e._s(e._f("substr")(t.row.costPrice))+"\n                    ")]}}],null,!1,2419433718)}),e._v(" "),a("el-table-column",{attrs:{align:"center","header-align":"center",prop:"netYield",label:"出成率",width:"140"}}),e._v(" "),a("el-table-column",{attrs:{align:"center","header-align":"center",prop:"number",label:"净数量",width:"140"}}),e._v(" "),a("el-table-column",{attrs:{align:"center","header-align":"center",label:"操作",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini"},on:{click:function(a){return e.handleClickDetail(t.$index,t.row,"edit")}}},[e._v("编辑")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return e.handleClickDetail(t.$index,t.row,"delete")}}},[e._v("删除")])]}}],null,!1,2993806499)})],1)],1):e._e()],1),e._v(" "),a("el-dialog",{attrs:{title:e.dialogTreeTitle,visible:e.dialogTreeFormVisible,width:"80%",top:"5vh"},on:{"update:visible":function(t){e.dialogTreeFormVisible=t}}},[a("el-container",[a("el-aside",[a("el-tree",{attrs:{"highlight-current":!0,"node-key":"id","default-expand-all":"",data:e.orgTreeData,props:e.defaultProps,"expand-on-click-node":!1},on:{"node-click":e.handleNodeClick}})],1),e._v(" "),a("el-main",[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.searchTreeForm,"label-width":"80px"}},[a("el-form-item",{staticStyle:{"font-family":"MicrosoftYaHeiLight","font-weight":"bold",color:"rgba(102,102,102,1)"},attrs:{label:"原料编号"}},[a("el-input",{attrs:{maxlength:200,autocomplete:"off",placeholder:"原料编号",clearable:""},model:{value:e.searchTreeForm.serialNo,callback:function(t){e.$set(e.searchTreeForm,"serialNo",t)},expression:"searchTreeForm.serialNo "}})],1),e._v(" "),a("el-form-item",{staticStyle:{"font-family":"MicrosoftYaHeiLight","font-weight":"bold",color:"rgba(102,102,102,1)"},attrs:{label:"原料名称"}},[a("el-input",{attrs:{maxlength:200,autocomplete:"off",placeholder:"原料名称",clearable:""},model:{value:e.searchTreeForm.name,callback:function(t){e.$set(e.searchTreeForm,"name",t)},expression:"searchTreeForm.name"}})],1),e._v(" "),a("el-form-item",{attrs:{"label-width":"0"}},[a("el-button",{attrs:{icon:"el-icon-search",circle:"","native-type":"submit"},nativeOn:{click:function(t){return t.preventDefault(),e.onSearchTree(t)}}})],1)],1),e._v(" "),a("el-table",{attrs:{data:e.tableTreeData,border:""}},[a("el-table-column",{attrs:{align:"center","header-align":"center",type:"index",label:"行号",width:"80"}}),e._v(" "),a("el-table-column",{attrs:{align:"center","header-align":"center",prop:"serialNo",label:"原料编号",width:"120"}}),e._v(" "),a("el-table-column",{attrs:{align:"center","header-align":"center",prop:"name",label:"原料名称"}}),e._v(" "),a("el-table-column",{attrs:{align:"center","header-align":"center",prop:"costPrice",label:"出售单价",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                            ￥"+e._s(e._f("substr")(t.row.costPrice))+"\n                        ")]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center","header-align":"center",prop:"stock",label:"库存量",width:"100"}}),e._v(" "),a("el-table-column",{attrs:{align:"center","header-align":"center",prop:"safeStock",label:"安全库存量",width:"100"}}),e._v(" "),a("el-table-column",{attrs:{align:"center","header-align":"center",prop:"safeStock",label:"净数量",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input-number",{staticStyle:{width:"130px"},attrs:{min:0},model:{value:e.tableTreeData[t.$index].number,callback:function(a){e.$set(e.tableTreeData[t.$index],"number",a)},expression:"tableTreeData[scope.$index].number"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center","header-align":"center",prop:"standard",label:"单位",width:"80"}}),e._v(" "),a("el-table-column",{attrs:{align:"center","header-align":"center",label:"操作",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(a){return e.handleClickTreeAdd(t.$index,t.row)}}},[e._v("添加")])]}}])})],1),e._v(" "),a("el-pagination",{attrs:{background:"","current-page":e.paramTree.pageNo,"page-size":e.paramTree.pageSize,layout:"total,prev, pager, next",total:e.totalTreeNum},on:{"current-change":e.handleCurrentChangeTree,"update:currentPage":function(t){return e.$set(e.paramTree,"pageNo",t)},"update:current-page":function(t){return e.$set(e.paramTree,"pageNo",t)}}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogTreeFormVisible=!1}}},[e._v("关闭")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogFormVisible,width:"25%"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{ref:"dialogForm",attrs:{model:e.dialogForm,rules:e.rules}},[a("el-form-item",{staticStyle:{width:"316px"},attrs:{label:"原料编号","label-width":e.formLabelWidth}},[a("el-input",{attrs:{placeholder:"请输入",disabled:""},model:{value:e.dialogForm.serialNo,callback:function(t){e.$set(e.dialogForm,"serialNo",t)},expression:"dialogForm.serialNo"}})],1),e._v(" "),a("el-form-item",{staticStyle:{width:"316px"},attrs:{label:"原料名称","label-width":e.formLabelWidth}},[a("el-input",{attrs:{placeholder:"请输入",disabled:""},model:{value:e.dialogForm.name,callback:function(t){e.$set(e.dialogForm,"name",t)},expression:"dialogForm.name"}})],1),e._v(" "),a("el-form-item",{staticStyle:{width:"316px"},attrs:{label:"单位","label-width":e.formLabelWidth}},[a("el-input",{attrs:{placeholder:"请输入",disabled:""},model:{value:e.dialogForm.standard,callback:function(t){e.$set(e.dialogForm,"standard",t)},expression:"dialogForm.standard"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"出售单价","label-width":e.formLabelWidth}},[a("el-input-number",{attrs:{min:0,disabled:""},model:{value:e.dialogForm.price,callback:function(t){e.$set(e.dialogForm,"price",t)},expression:"dialogForm.price"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"净数量","label-width":e.formLabelWidth}},[a("el-input-number",{attrs:{min:0,max:999999999},model:{value:e.dialogForm.number,callback:function(t){e.$set(e.dialogForm,"number",t)},expression:"dialogForm.number"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary",loading:e.saveLoading},on:{click:function(t){return e.dialogFormAdd("dialogForm")}}},[e._v("确 定")])],1)],1)],1)},[],!1,null,"79a0d067",null);o.options.__file="editGroup.vue";t.default=o.exports},Pr7a:function(e,t,a){"use strict";var r=a("lVBc");a.n(r).a},lVBc:function(e,t,a){}}]);