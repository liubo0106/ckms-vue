(window.webpackJsonp=window.webpackJsonp||[]).push([[65],{BnH2:function(e,t,a){"use strict";a.r(t);var r=a("TsPW"),i={name:"edit-user-manage",data:function(){return{tableData:null,formLabelWidth:"80px",dialogTreeFormVisible:!1,dialogTreeTitle:"新增领料明细",dialogForm:{standard:"",number:"",price:"",id:"",name:"",serialNo:"",productInfoId:"",spec:"",rawPrice:"",discount:"",amount:""},id:"",saveLoading:!1,editForm:{name:"",orderNo:"",dateTime:"",totalNumber:0,totalPrice:0,remark:"",supplierId:"",id:""},headers:{sessionId:sessionStorage.getItem("sessionId")},supplierList:[],productList:[],param:{pageNo:1,pageSize:0,status:1},param2:{pid:""},rules:{name:[{required:!0,message:"请输入领料单名称",trigger:"blur"}],dateTime:[{required:!0,message:"请输入领料日期",trigger:"blur"}]},content:"",searchTreeForm:{name:"",serialNo:""},tableTreeData:null,paramTree:{name:"",pageNo:1,pageSize:10,deptId:"",checkChild:"all",serialNo:"",categoryId:"",isDelete:1},totalTreeNum:0,orgTreeData:[],defaultProps:{children:"children",label:"name"},unitFromList:[],unitFromDialogFormVisible:!1,unitFrom:"",value2:"",value6:"",value7:"",shopData:[],shopDataList:[]}},methods:{getorderList:function(){var e=this;this.param.pageSize=-1,this.param.beginDate=this.value6[0],this.param.endDate=this.value6[1],this.param.status=2,Object(r.Nd)(this.param).then(function(t){200==t.status&&(e.shopData=t.data.items)})},getShopList:function(){var e=this;this.id=1;var t={pid:this.value2};this.$confirm("是否确定选择?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(r.Bb)(t).then(function(t){if(200==t.status){e.shopDataList=[],e.shopDataList=t.data;var a=e;e.shopDataList.forEach(function(t){void 0===t.pickOrderId&&e.$set(t,"pickOrderId",e.editForm.id),t.id=null}),Object(r.ac)(e.shopDataList).then(function(t){200==t.status?(e.$message({type:"success",message:"数据添加成功！"}),a.getAjaxList()):(e.$message({type:"success",message:"数据添加成功"}),a.getAjaxList())})}})}).catch(function(){})},handleNodeClick:function(e){this.searchTreeForm.name="",this.paramTree.name="",this.paramTree.categoryId="","0"==e.id||(this.paramTree.categoryId=e.id),this.paramTree.pageNo=1,this.getTreeAjaxPage()},onSearchTree:function(){this.paramTree.pageNo=1,this.paramTree.serialNo=this.searchTreeForm.serialNo,this.paramTree.name=this.searchTreeForm.name,this.getTreeAjaxPage()},handleCurrentChangeTree:function(e){this.paramTree.pageNo=e,this.getTreeAjaxPage()},getTreeAjaxPage:function(){var e=this;Object(r.Md)(e.paramTree).then(function(t){if(200==t.status){var a=t.data.items;a&&a.length>0?(e.tableTreeData=a,e.totalTreeNum=parseInt(t.data.totalNum)):(e.tableTreeData=[],e.totalTreeNum=0)}})},getTreeAjaxList:function(){var e=this;Object(r.Ld)({}).then(function(t){if(200==t.status){var a=t.data;a&&a.length>0?e.orgTreeData=a:e.orgTreeData=[]}})},handleClickTreeAdd:function(e,t){this.dialogForm.standard=t.standard,this.dialogForm.number=this.tableTreeData[e].number,this.dialogForm.id="",this.dialogForm.price=t.price,this.dialogForm.productInfoId=t.id,this.dialogForm.name=t.name,this.dialogForm.spec=t.spec,this.dialogForm.rawPrice=t.rawPrice,this.dialogForm.discount=t.discount,this.dialogForm.amount=t.amount,this.dialogForm.serialNo=t.serialNo,this.tableTreeData[e].number<=0?this.$message({type:"error",message:"数量必须大于0"}):this.unitFromDialogFormVisible=!0},getdatatime:function(){var e=new Date,t=e.getFullYear(),a=e.getMonth()+1,r=a>9?a:"0"+a,i=e.getDate(),o=i>9?i:"0"+i;this.editForm.dateTime=t+"-"+r+"-"+o},handleClickDetail:function(e,t,a){var i=this;"delete"==a?i.$confirm("真的删除该行数据么, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var e={id:t.id};Object(r.G)(e).then(function(e){200==e.status?i.$message({type:"success",message:"删除成功!",duration:300,onClose:function(){i.getAjaxList(1)}}):i.$message({type:"error",message:e.msg})})}).catch(function(){i.$message({type:"info",message:"已取消删除"})}):"add"==a&&(this.getTreeAjaxPage(),this.getTreeAjaxList(),this.dialogTreeFormVisible=!0)},unitFromAdd:function(){var e=this,t=this,a=0;if(this.unitFrom){a=this.unitFromList.find(function(t){return t.id===e.unitFrom}).ratio*this.dialogForm.number}else a=this.dialogForm.number;var i;i={id:this.dialogForm.id,standard:this.dialogForm.standard,number:a,price:this.dialogForm.price,name:this.dialogForm.name,serialNo:this.dialogForm.serialNo,spec:this.dialogForm.spec,rawPrice:this.dialogForm.rawPrice,productInfoId:this.dialogForm.productInfoId,discount:this.dialogForm.discount,amount:this.dialogForm.amount,pickOrderId:t.id},Object(r.Rc)(i).then(function(e){200==e.status?t.$message({type:"success",message:"操作成功!",duration:300,onClose:function(){t.saveLoading=!1,t.unitFromDialogFormVisible=!1,t.getAjaxList(1)}}):(t.unitFromDialogFormVisible=!1,t.saveLoading=!1,t.$message({type:"error",message:e.msg}))})},getAjaxList:function(e){var t=this;Object(r.zb)(t.param2).then(function(a){t.tableData=[];var r=a.data;if(r&&r.length>0){t.tableData=r;for(var i=0,o=0,l=0;l<t.tableData.length;l++)i+=t.tableData[l].price*t.tableData[l].number,o+=t.tableData[l].number;t.editForm.totalPrice=i,t.editForm.totalNumber=o,1==e&&t.requestClientInfo()}else t.tableData=[]})},requestClientInfo:function(){var e=this,t=this;Object(r.Mb)({id:this.id}).then(function(a){if(200==a.status){var r=a.data;r&&(t.editForm.name=r.name,t.editForm.orderNo=r.orderNo,t.editForm.dateTime=r.dateTime,t.editForm.totalNumber=r.totalNumber,t.editForm.totalPrice=r.totalPrice,t.editForm.remark=r.remark,t.editForm.id=r.id)}else e.$message({message:"请求异常",type:"error"})})},goBack:function(){this.$router.push({path:"/material"})},submitForm:function(e){var t=this,a=this;this.$refs[e].validate(function(e){if(!e)return!1;a.saveLoading=!0;var i={name:a.editForm.name,dateTime:a.editForm.dateTime,totalNumber:a.editForm.totalNumber,totalPrice:a.editForm.totalPrice,remark:a.editForm.remark,id:a.id};Object(r.Qc)(i).then(function(e){t.$message({type:"success",message:"操作成功!",duration:300,onClose:function(){sessionStorage.setItem("materialId",e.data.id),a.id=e.data.id,a.param2.pid=e.data.id,a.requestClientInfo(),a.getAjaxList(2),a.saveLoading=!1}})})})},getAjaxUnitConversionPage:function(){var e=this;Object(r.De)({pageSize:0}).then(function(t){if(200==t.status){var a=t.data.items;a&&a.length>0?e.unitFromList=a:e.unitFromList=[]}})}},filters:{substr:function(e){return e.toFixed(2)}},beforeMount:function(){var e=sessionStorage.getItem("materialId");e&&(this.id=e,this.param2.pid=e,this.requestClientInfo(),this.getAjaxList(2)),this.getdatatime(),this.getAjaxUnitConversionPage()}},o=(a("Q8Nf"),a("KHd+")),l=Object(o.a)(i,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",[a("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[a("el-breadcrumb-item",{attrs:{to:{path:"/material"}}},[e._v("领料单管理")]),e._v(" "),a("el-breadcrumb-item",[e._v(e._s(""==e.id?"新增":"编辑"))])],1),e._v(" "),a("div",{staticClass:"contentBody"},[a("el-form",{ref:"editForm",staticClass:"demo-ruleForm",attrs:{model:e.editForm,rules:e.rules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"领料单名称",prop:"name"}},[a("el-input",{attrs:{placeholder:"请输入"},model:{value:e.editForm.name,callback:function(t){e.$set(e.editForm,"name",t)},expression:"editForm.name"}})],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"领料日期",prop:"dateTime"}},[a("el-date-picker",{attrs:{type:"date",placeholder:"选择日期","value-format":"yyyy-MM-dd"},model:{value:e.editForm.dateTime,callback:function(t){e.$set(e.editForm,"dateTime",t)},expression:"editForm.dateTime"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{staticStyle:{width:"316px"},attrs:{label:"总量"}},[a("el-input",{attrs:{placeholder:"请输入",maxlength:200,disabled:""},model:{value:e.editForm.totalNumber,callback:function(t){e.$set(e.editForm,"totalNumber",t)},expression:"editForm.totalNumber"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{staticStyle:{width:"316px"},attrs:{label:"总价"}},[a("el-input",{attrs:{placeholder:"请输入",maxlength:200,disabled:""},model:{value:e.editForm.totalPrice,callback:function(t){e.$set(e.editForm,"totalPrice",t)},expression:"editForm.totalPrice"}})],1)],1)],1),e._v(" "),e.id?a("el-form-item",{attrs:{label:"选择采购单"}},[a("el-date-picker",{attrs:{type:"daterange",align:"left","unlink-panels":"","range-separator":"至","value-format":"yyyy-MM-dd","start-placeholder":"开始日期","end-placeholder":"结束日期"},on:{blur:function(t){return e.getorderList()}},model:{value:e.value6,callback:function(t){e.value6=t},expression:"value6"}}),e._v(" "),a("el-select",{attrs:{placeholder:"请选择"},on:{change:function(t){return e.getShopList()}},model:{value:e.value2,callback:function(t){e.value2=t},expression:"value2"}},e._l(e.shopData,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1):e._e(),e._v(" "),a("el-form-item",{attrs:{label:"备注"}},[a("el-input",{attrs:{type:"textarea",placeholder:"请输入",maxlength:200},model:{value:e.editForm.remark,callback:function(t){e.$set(e.editForm,"remark",t)},expression:"editForm.remark"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",loading:e.saveLoading},on:{click:function(t){return e.submitForm("editForm")}}},[e._v("提交")]),e._v(" "),a("el-button",{on:{click:function(t){return e.goBack()}}},[e._v("返回")])],1)],1),e._v(" "),e.id?a("div",{staticClass:"contentBody"},[a("el-form",{staticClass:"demo-form-inline",attrs:{"label-width":"60px"}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:4}},[a("el-form-item",{attrs:{"label-width":"0"}},[a("el-button",{attrs:{icon:"el-icon-plus",circle:""},on:{click:function(t){return e.handleClickDetail("","","add")}}})],1)],1)],1)],1),e._v(" "),a("el-table",{attrs:{data:e.tableData,border:""}},[a("el-table-column",{attrs:{align:"center","header-align":"center",type:"index",label:"序号",width:"80"}}),e._v(" "),a("el-table-column",{attrs:{align:"center","header-align":"center",prop:"serialNo",label:"原料编号"}}),e._v(" "),a("el-table-column",{attrs:{align:"center","header-align":"center",prop:"name",label:"原料名称"}}),e._v(" "),a("el-table-column",{attrs:{align:"center","header-align":"center",prop:"standard",label:"单位"}}),e._v(" "),a("el-table-column",{attrs:{align:"center","header-align":"center",prop:"number",label:"数量",width:"140"}}),e._v(" "),a("el-table-column",{attrs:{align:"center","header-align":"center",prop:"price",label:"单价",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                        ￥"+e._s(e._f("substr")(t.row.price))+"\n                    ")]}}],null,!1,3440111581)}),e._v(" "),a("el-table-column",{attrs:{align:"center","header-align":"center",label:"操作",width:"260"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return e.handleClickDetail(t.$index,t.row,"delete")}}},[e._v("删除")])]}}],null,!1,2088583025)})],1)],1):e._e()],1),e._v(" "),a("el-dialog",{attrs:{title:e.dialogTreeTitle,visible:e.dialogTreeFormVisible,width:"80%",top:"5vh"},on:{"update:visible":function(t){e.dialogTreeFormVisible=t}}},[a("el-container",[a("el-aside",[a("el-tree",{attrs:{"highlight-current":!0,"node-key":"id","default-expand-all":"",data:e.orgTreeData,props:e.defaultProps,"expand-on-click-node":!1},on:{"node-click":e.handleNodeClick}})],1),e._v(" "),a("el-main",[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.searchTreeForm,"label-width":"80px"}},[a("el-form-item",{staticStyle:{"font-family":"MicrosoftYaHeiLight","font-weight":"bold",color:"rgba(102,102,102,1)"},attrs:{label:"原料编号"}},[a("el-input",{attrs:{maxlength:200,autocomplete:"off",placeholder:"原料编号",clearable:""},model:{value:e.searchTreeForm.serialNo,callback:function(t){e.$set(e.searchTreeForm,"serialNo",t)},expression:"searchTreeForm.serialNo "}})],1),e._v(" "),a("el-form-item",{staticStyle:{"font-family":"MicrosoftYaHeiLight","font-weight":"bold",color:"rgba(102,102,102,1)"},attrs:{label:"原料名称"}},[a("el-input",{attrs:{maxlength:200,autocomplete:"off",placeholder:"原料名称",clearable:""},model:{value:e.searchTreeForm.name,callback:function(t){e.$set(e.searchTreeForm,"name",t)},expression:"searchTreeForm.name"}})],1),e._v(" "),a("el-form-item",{attrs:{"label-width":"0"}},[a("el-button",{attrs:{icon:"el-icon-search",circle:"","native-type":"submit"},nativeOn:{click:function(t){return t.preventDefault(),e.onSearchTree(t)}}})],1)],1),e._v(" "),a("el-table",{attrs:{data:e.tableTreeData,border:""}},[a("el-table-column",{attrs:{align:"center","header-align":"center",type:"index",label:"行号",width:"80"}}),e._v(" "),a("el-table-column",{attrs:{align:"center","header-align":"center",prop:"serialNo",label:"原料编号",width:"120"}}),e._v(" "),a("el-table-column",{attrs:{align:"center","header-align":"center",prop:"name",label:"原料名称"}}),e._v(" "),a("el-table-column",{attrs:{align:"center","header-align":"center",prop:"standard",label:"单位"}}),e._v(" "),a("el-table-column",{attrs:{align:"center","header-align":"center",prop:"price",label:"出售单价",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                            ￥"+e._s(e._f("substr")(t.row.price))+"\n                        ")]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center","header-align":"center",prop:"stock",label:"库存量",width:"80"}}),e._v(" "),a("el-table-column",{attrs:{align:"center","header-align":"center",prop:"safeStock",label:"安全库存量",width:"80"}}),e._v(" "),a("el-table-column",{attrs:{align:"center","header-align":"center",prop:"safeStock",label:"数量",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input-number",{staticStyle:{width:"130px"},attrs:{min:0,max:e.tableTreeData[t.$index].stock},model:{value:e.tableTreeData[t.$index].number,callback:function(a){e.$set(e.tableTreeData[t.$index],"number",a)},expression:"tableTreeData[scope.$index].number"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center","header-align":"center",label:"操作",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(a){return e.handleClickTreeAdd(t.$index,t.row)}}},[e._v("添加")])]}}])})],1),e._v(" "),a("el-pagination",{attrs:{background:"","current-page":e.paramTree.pageNo,"page-size":e.paramTree.pageSize,layout:"total,prev, pager, next",total:e.totalTreeNum},on:{"current-change":e.handleCurrentChangeTree,"update:currentPage":function(t){return e.$set(e.paramTree,"pageNo",t)},"update:current-page":function(t){return e.$set(e.paramTree,"pageNo",t)}}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogTreeFormVisible=!1}}},[e._v("关闭")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"添加",visible:e.unitFromDialogFormVisible,width:"30%"},on:{"update:visible":function(t){e.unitFromDialogFormVisible=t}}},[a("el-form",[a("el-form-item",{attrs:{label:"原单位","label-width":"100px"}},[a("el-select",{attrs:{placeholder:"请选择",clearable:""},model:{value:e.unitFrom,callback:function(t){e.unitFrom=t},expression:"unitFrom"}},e._l(e.unitFromList,function(e){return a("el-option",{attrs:{label:e.unitFrom,value:e.id}})}),1)],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.unitFromDialogFormVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.unitFromAdd}},[e._v("确 定")])],1)],1)],1)},[],!1,null,"52801eb6",null);l.options.__file="editMaterial.vue";t.default=l.exports},Q8Nf:function(e,t,a){"use strict";var r=a("R5EN");a.n(r).a},R5EN:function(e,t,a){}}]);