(window.webpackJsonp=window.webpackJsonp||[]).push([[53],{"2gMN":function(e,t,o){"use strict";var a=o("BuAz");o.n(a).a},BuAz:function(e,t,o){},"RU/L":function(e,t,o){o("Rqdy");var a=o("WEpk").Object;e.exports=function(e,t,o){return a.defineProperty(e,t,o)}},Rqdy:function(e,t,o){var a=o("Y7ZC");a(a.S+a.F*!o("jmDH"),"Object",{defineProperty:o("2faE").f})},SEkw:function(e,t,o){e.exports={default:o("RU/L"),__esModule:!0}},YEIV:function(e,t,o){"use strict";t.__esModule=!0;var a=function(e){return e&&e.__esModule?e:{default:e}}(o("SEkw"));t.default=function(e,t,o){return t in e?(0,a.default)(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}},"fEB/":function(e,t,o){"use strict";o.r(t);var a=o("YEIV"),i=o.n(a),s=o("TsPW"),r={name:"user-manage",data:function(){var e,t=sessionStorage.getItem("customerId");return"null"==t&&(t=""),e={options:[{value:"2",label:"微信支付"},{value:"3",label:"支付宝支付"},{value:"1",label:"现金支付"},{value:"4",label:"其它支付"}],buttonPu:"primary",dialogCoupon:!1,discount:"",showCoupon:1,buttonHui:"",tableData:null,dialogTreeFormVisible:!1,dialogTreeTitle:"选择会员",param:{customerId:t},statusList:[],param2:{status:"0",pageNo:1,pageSize:0},clientType:"0",paramTree:{content:"",pageNo:1,pageSize:15,status:1},searchForm:{username:""},totalTreeNum2:0,tableTreeData2:null,paramTree2:{name:"",pageNo:1,pageSize:10,deptId:"",checkChild:"all",serialNo:"",packCategoryId:""},activeName:"",dialogFormTitle:"结算",dialogFormVisible:!1,dialogForm:{discount:"",remark:"",name:"",phone:"",memberId:"",discount2:"",deskId:"",totalPrice:0,discountPrice:0,noDiscountAmount:0,recPrice:0,fraction:"",coupon:0,type:1,customerId:t,paymentMethod:"",orderNo:""},smallRemoveZero:0,bigRemoveZero:0,removeZero:0,saveLoading:!1,checkOutList:[],dialogZhuanTaiFormVisible:!1,dialogZhuanTaiForm:{deskId:"",oldDeskNo:"",oldDeskId:""},couponData:[],dialogCopyFormVisible:!1,dialogCopyForm:{deskId:"",oldDeskNo:"",oldDeskId:""},rules:{deskId:[{required:!0,message:"请选择桌号",trigger:"change"}]},dialogIsOkFormVisible:!1,dialogIsOkForm:{},couponDataList:[],orderList:[],IntegralruleData:"",allIntergralrule:0,useIntegrale:0,deductionAcount:0,ListLoading:!1,orderId:"",value:0,nowPrice:"",goodsData:[],delPrice:0,goodsPrice:0},i()(e,"discount",""),i()(e,"fraction",0),i()(e,"amountPrice",0),i()(e,"rules",{paymentMethod:[{required:!0,message:"请选择活动区域",trigger:"change"}]}),e},computed:{totalPrice:function(){return(this.dialogForm.totalPrice-this.goodsPrice)*this.discount+(1-this.discount)*this.dialogForm.noDiscountAmount-this.dialogForm.coupon-parseInt(this.delPrice)-this.deductionAcount}},methods:{handleChange:function(){void 0==this.delPrice&&(this.delPrice=0)},pushOrder:function(e){var t=this,o=this;this.$refs[e].validate(function(e){if(!e)return!1;var a,i="";1==(a=o.tableData.find(function(e){return e.id===o.dialogZhuanTaiForm.deskId})).status&&(i=a.deskNo+"号桌正在被使用！"),t.$confirm("确定将该桌合并到"+a.deskNo+"号桌吗？"+i+"是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){o.saveLoading=!0,Object(s.hb)({id:o.dialogZhuanTaiForm.oldDeskId,toId:o.dialogZhuanTaiForm.deskId,deskNo:a.deskNo}).then(function(e){200==e.status?t.$message({type:"success",message:"合并成功!",duration:300,onClose:function(){o.saveLoading=!1,o.dialogZhuanTaiFormVisible=!1,o.getAjaxList(),o.getStatusAjaxList()}}):(o.saveLoading=!1,o.dialogZhuanTaiFormVisible=!1,o.$message({type:"error",message:e.msg}))})}).catch(function(){t.$message({type:"info",message:"已取消"})})})},handelDoType:function(e,t){"hebin"==t&&(this.dialogZhuanTaiForm.deskId="",this.dialogZhuanTaiForm.oldDeskId=e.id,this.dialogZhuanTaiForm.oldDeskNo=e.deskNo,this.dialogZhuanTaiFormVisible=!0),"zhuantai"==t?(this.dialogZhuanTaiForm.deskId="",this.dialogZhuanTaiForm.oldDeskId=e.id,this.dialogZhuanTaiForm.oldDeskNo=e.deskNo,this.dialogZhuanTaiFormVisible=!0):"fuzhi"==t&&(this.dialogCopyForm.deskId="",this.dialogCopyForm.deskNo="",this.dialogCopyForm.oldDeskId=e.id,this.dialogCopyForm.oldDeskNo=e.deskNo,this.dialogCopyFormVisible=!0)},isActive:function(e){console.log(this.allIntergralrule<this.IntegralruleData.integral),e?(this.dialogForm.totalPrice-this.goodsPrice)*this.discount+(1-this.discount)*this.dialogForm.noDiscountAmount-this.dialogForm.coupon-parseInt(this.delPrice)-this.deductionAcount>this.IntegralruleData.minUseAmount&&this.allIntergralrule>this.IntegralruleData.integral?e?(this.allIntergralrule=this.allIntergralrule-this.IntegralruleData.integral,this.useIntegrale=this.IntegralruleData.integral,this.deductionAcount=this.IntegralruleData.amount):(this.allIntergralrule=this.allIntergralrule+this.IntegralruleData.integral,this.useIntegrale=0,this.deductionAcount=0):(this.$message({type:"error",message:"不满足积分使用规则"}),this.value=0):(this.allIntergralrule=this.allIntergralrule+this.IntegralruleData.integral,this.useIntegrale=0,this.deductionAcount=0)},checkCoupondata:function(e,t){this.couponData[t].check=!this.couponData[t].check},confrimCoupon:function(){this.couponDataList=[];for(var e=0,t=0;t<this.couponData.length;t++)this.couponData[t].check&&this.couponDataList.push(this.couponData[t]);if(0==this.couponDataList.length)this.dialogForm.coupon=0,this.goodsPrice=0;else for(var o=0;o<this.couponDataList.length;o++)if("2"==this.couponDataList[o].type)this.goodsPrice=this.couponDataList[o].couponAmount,console.log(this.goodsPrice);else{if(e+=parseInt(this.couponDataList[o].couponAmount),this.couponDataList.length>4)return this.$message({type:"error",message:"只能选择四个优惠卷"}),!1;if(e>(this.dialogForm.totalPrice-this.goodsPrice)*this.discount+(1-this.discount)*this.dialogForm.noDiscountAmount-this.dialogForm.coupon-parseInt(this.delPrice)-this.deductionAcount)return this.$message({type:"error",message:"优惠金额不能大于结算金额"}),!1}-1==this.couponDataList.findIndex(function(e){return"2"==e.type})&&(this.goodsPrice=0),this.dialogForm.coupon=e,this.dialogCoupon=!1},spanClick:function(e){console.log(e)},changePlay:function(e){this.dialogForm.paymentMethod=e,console.log(this.dialogForm.paymentMethod)},checkCoupon:function(){this.dialogCoupon=!0;for(var e=0;e<this.couponData.length;e++)"1"==this.couponData[e].type&&("1"==this.couponData[e].couponUploadStatus?this.couponData[e].isPrice=!0:this.couponData[e].isPrice=!1);if(this.goodsData.length>=this.couponData.length)for(var t=0;t<this.goodsData.length;t++)for(var o=0;o<this.couponData.length;o++)this.goodsData[t].goodsId==this.couponData[o].couponId&&(this.couponData[o].isPrice=!1);else for(var a=0;a<this.couponData.length;a++)for(var i=0;i<this.goodsData.length;i++)this.goodsData[i].goodsId==this.couponData[a].couponId&&(this.couponData[a].isPrice=!1)},dialogZhuanTaiFormSubmit:function(e){var t=this,o=this;this.$refs[e].validate(function(e){if(!e)return!1;var a,i="";1==(a=o.tableData.find(function(e){return e.id===o.dialogZhuanTaiForm.deskId})).status&&(i=a.deskNo+"号桌正在被使用！"),t.$confirm("确定将该桌转移到"+a.deskNo+"号桌吗？"+i+"是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){o.saveLoading=!0,Object(s.Ke)({id:o.dialogZhuanTaiForm.oldDeskId,toId:o.dialogZhuanTaiForm.deskId,deskNo:a.deskNo}).then(function(e){200==e.status?t.$message({type:"success",message:"转桌成功!",duration:300,onClose:function(){o.saveLoading=!1,o.dialogZhuanTaiFormVisible=!1,o.getAjaxList(),o.getStatusAjaxList()}}):(o.saveLoading=!1,o.dialogZhuanTaiFormVisible=!1,o.$message({type:"error",message:e.msg}))})}).catch(function(){t.$message({type:"info",message:"已取消"})})})},dialogCopyFormSubmit:function(e){var t=this,o=this;this.$refs[e].validate(function(e){if(!e)return!1;var a,i="";1==(a=o.tableData.find(function(e){return e.id===o.dialogCopyForm.deskId})).status&&(i=a.deskNo+"号桌正在被使用！"),t.$confirm("确定将该桌菜单复制到"+a.deskNo+"号桌吗？"+i+"是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){localStorage.setItem("oldDeskId",o.dialogCopyForm.oldDeskId),localStorage.setItem("newDeskId",o.dialogCopyForm.deskId),localStorage.setItem("newDeskNo",a.deskNo),o.$router.push({path:"/editOrder"})}).catch(function(){t.$message({type:"info",message:"已取消"})})})},memberClick:function(){void 0==this.dialogForm.id&&this.$message({type:"erroe",message:"请选择会员!",duration:3e3,onClose:function(){}})},handleClickDetail:function(e,t,o){"add"==o?(this.dialogForm.type="2",this.buttonHui="primary",this.buttonPu="","add"==o&&this.addOrg("add",t)):"add2"==o&&(this.buttonPu="primary",this.buttonHui="",this.dialogForm.type="1",this.dialogForm.memberId="",this.dialogForm.discount2="",this.dialogForm.discount="",this.smallRemoveZero=this.dialogForm.totalPrice-10,this.bigRemoveZero=this.dialogForm.totalPrice,this.dialogForm.discountPrice=this.dialogForm.totalPrice)},addOrg:function(e,t){this.dialogTreeFormVisible=!0,this.getTreeAjaxPage()},getTreeAjaxPage:function(){var e=this;Object(s.Ld)(e.paramTree).then(function(t){if(200==t.status){var o=t.data.items;o&&o.length>0?(e.tableTreeData2=o,e.totalTreeNum=parseInt(t.data.totalNum)):(e.tableTreeData2=[],e.totalTreeNum=0)}})},handleCurrentChangeTree2:function(e){this.paramTree2.pageNo=e,this.getTreeAjaxPage2()},onSearch:function(){this.paramTree.pageNo=1,this.paramTree.content=this.searchForm.username,this.getTreeAjaxPage()},handleClickTreeAdd2:function(e,t){var o=this,a=t.discount;this.discount=t.discount,console.log(this.discount);var i=parseFloat(this.dialogForm.noDiscountAmount),r=(parseFloat(this.dialogForm.recPrice),parseFloat(this.dialogForm.totalPrice));this.allIntergralrule=t.integral,this.amountPrice=t.amount,this.dialogForm.name=t.name,this.dialogForm.phone=t.phone,this.dialogForm.memberId=t.id,this.dialogForm.discount2=t.discount,this.dialogForm.discount=t.discount,this.dialogForm.discountPrice=(r*a+(1-a)*i).toFixed(2),console.log(this.dialogForm.discountPrice),this.smallRemoveZero=a*parseFloat(this.dialogForm.discountPrice)-10,this.bigRemoveZero=a*parseFloat(this.dialogForm.discountPrice),this.dialogTreeFormVisible=!1,this.couponData=[],Object(s.l)({memberId:t.id}).then(function(e){200==e.status&&(o.couponData=e.data,o.couponData.forEach(function(e){o.$set(e,"check",!1),o.$set(e,"isPrice",!0)})),Object(s.ne)({id:o.orderId}).then(function(e){if(200==e.status){for(var t=e.data.orders,a=0;a<t.length;a++)for(var i=0;i<t[a].detailList.length;i++)o.goodsData.push(t[a].detailList[i]);console.log(o.goodsData)}})}),Object(s.zb)({type:2}).then(function(e){200==e.status&&(o.IntegralruleData=e.data)})},initWebSocket:function(){var e=sessionStorage.getItem("user");if(e){e=JSON.parse(e);var t=s.Pe.replace("http","ws")+"webSocket/"+e.id;this.websock=new WebSocket(t),this.websock.onopen=this.websocketonopen,this.websock.onerror=this.websocketonerror,this.websock.onmessage=this.websocketonmessage,this.websock.onclose=this.websocketclose}},websocketonopen:function(){console.log("WebSocket连接成功")},websocketonerror:function(e){console.log("WebSocket连接发生错误")},websocketonmessage:function(e){if(e.data){var t=JSON.parse(e.data);console.log(t),this.statusList.unshift(t.data),this.messageBox(t)}},websocketclose:function(e){console.log("connection closed")},messageBox:function(e){if(window.Notification){var t=function(){if("granted"==Notification.permission){var t=new Notification("新的消息",{body:e.title,requireInteraction:!0});t.onclick=function(){t.close()}}};"granted"==Notification.permission?t():"denied"!=Notification.permission&&Notification.requestPermission(function(e){t()})}else alert("浏览器不支持Notification")},changeCount:function(e){var t=parseFloat(this.dialogForm.discount/10).toFixed(2),o=parseFloat(this.dialogForm.noDiscountAmount),a=(parseFloat(this.dialogForm.recPrice),parseFloat(this.dialogForm.totalPrice));e?(this.dialogForm.discountPrice=(a*t+(1-t)*o).toFixed(2),this.smallRemoveZero=this.dialogForm.discountPrice-10,this.bigRemoveZero=this.dialogForm.discountPrice):(this.dialogForm.discountPrice=this.dialogForm.totalPrice,this.smallRemoveZero=this.dialogForm.totalPrice-10,this.bigRemoveZero=this.dialogForm.totalPrice)},getFlavorAjaxList:function(){var e=this;Object(s.Je)({type:"折扣"}).then(function(t){var o=t.data;200==t.status?o&&o.length>0?e.checkOutList=o:e.checkOutList=[]:e.$message({message:"请求异常",type:"error"})})},dialogFormSubmit:function(e){var t=this;if("budget"==e)this.$confirm("确定预结算该桌已确认的订单吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(){t.ListLoading=!0;var e;e={deskId:t.dialogForm.deskId,customerId:t.dialogForm.customerId},Object(s.d)(e).then(function(e){200==e.status?(t.$message({type:"success",message:"预结算成功!",duration:300}),t.ListLoading=!1):(t.saveLoading=!1,t.dialogFormVisible=!0,t.$message({type:"error",message:e.msg}),t.ListLoading=!1)})});else{var o=this;if((this.dialogForm.totalPrice-this.goodsPrice)*this.discount+(1-this.discount)*this.dialogForm.noDiscountAmount-this.dialogForm.coupon-parseInt(this.delPrice)-this.deductionAcount>this.amountPrice)return this.$message({type:"error",message:"会员余额不足,请充值"}),!1;if(1==this.dialogForm.type&&""==this.dialogForm.paymentMethod)return this.$message({type:"error",message:"请选择支付方式",duration:1e3}),!1;this.$confirm("确定结算该桌已确认的订单吗？ 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.saveLoading=!0,console.log(t.dialogForm.orderNo),Object(s.xe)({orderNo:t.dialogForm.orderNo}).then(function(e){if(400==e.status)return t.$message({type:"error",message:e.msg,duration:2e3}),t.saveLoading=!1,!1;if(500==e.status&&(t.$message({type:"error",message:e.msg,duration:2e3}),t.getAjaxList(),t.saveLoading=!1),200==e.status){""==t.dialogForm.discount&&(t.dialogForm.discount=10);for(var a=[],i=0;i<t.couponDataList.length;i++)a.push(t.couponDataList[i].id);2==t.dialogForm.type?(t.discount=t.dialogForm.discount,t.fraction=parseInt(t.delPrice)):(t.fraction=(l*t.discount+(1-t.discount)*n-t.dialogForm.coupon).toFixed(2)-t.dialogForm.discountPrice,t.discount=parseFloat(t.dialogForm.discount/10).toFixed(2));var r=a.join(","),n=parseFloat(t.dialogForm.noDiscountAmount),l=parseFloat(t.dialogForm.totalPrice);Object(s.pe)({deskId:t.dialogForm.deskId,discount:t.dialogForm.discount,memberId:t.dialogForm.memberId,remark:t.dialogForm.remark,fraction:t.fraction,type:t.dialogForm.type,customerId:t.dialogForm.customerId,paymentMethod:t.dialogForm.paymentMethod,couponMoney:t.dialogForm.coupon,couponIds:r,useIntegrale:t.useIntegrale,deductionAcount:t.deductionAcount,giveGoodsMoney:t.goodsPrice}).then(function(e){200==e.status?(t.$message({type:"success",message:"结算成功!",duration:300,onClose:function(){o.saveLoading=!1,o.dialogFormVisible=!1,o.getAjaxList()}}),t.saveLoading=!1):(t.saveLoading=!1,t.dialogFormVisible=!0,t.$message({type:"error",message:e.msg}))})}})})}},checkOut:function(e){var t=this;this.value=0,this.orderId=e.id,this.dialogForm.type="1",this.buttonPu="primary",this.dialogForm.discount="",this.buttonHui="",this.couponDataList=[],this.goodsPrice=0,this.delPrice=0,this.goodsData=[],this.dialogForm.coupon=0,this.dialogFormTitle="第"+e.deskNo+"号桌结算",Object(s.oe)({deskId:e.id}).then(function(o){console.log(o),200==o.status?200==o.data.result?(t.dialogFormVisible=!0,t.dialogForm.deskId=e.id,t.dialogForm.recPrice=o.data.recPrice,t.dialogForm.totalPrice=o.data.totalPrice,t.dialogForm.noDiscountAmount=o.data.noDiscountAmount,t.dialogForm.discountPrice=o.data.totalPrice,t.dialogForm.orderNo=o.data.orders[0].orderNo,t.smallRemoveZero=o.data.totalPrice-10,t.bigRemoveZero=o.data.totalPrice,t.getFlavorAjaxList()):t.$message({type:"error",message:o.data.orders}):t.$message({type:"error",message:o.data})})},addOrder:function(e){1==e.isOpen&&(sessionStorage.setItem("deskId",e.id),sessionStorage.setItem("deskNo",e.deskNo),e.orders&&e.orders.length>0?sessionStorage.setItem("doType","edit"):sessionStorage.setItem("doType","add"),this.$router.push({path:"/editorder"}))},getAjaxList:function(){var e=this;Object(s.me)(e.param).then(function(t){var o=t.data;o&&o.length>0?e.tableData=o:e.tableData=[]})},getStatusAjaxList:function(){var e=this;Object(s.Ud)(e.param2).then(function(t){var o=t.data.items;o&&o.length>0?e.statusList=o:e.statusList=[]})},onClickQueRen:function(e){var t=this;this.dialogIsOkFormVisible=!0,this.dialogIsOkForm=e,this.orderList=[],Object(s.ue)({pid:this.dialogIsOkForm.id}).then(function(e){if(200==e.status){var o=e.data;o&&o.length>0&&(t.orderList=o)}else t.$message({message:"请求异常",type:"error"})})},dialogIsOkFormSubmit:function(){var e=this,t=this;this.$confirm("确认该订单吗？ 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.saveLoading=!0;var e={id:t.dialogIsOkForm.id,status:1};Object(s.e)({orderId:t.dialogIsOkForm.id}).then(function(o){"200"==o.status?Object(s.ke)(e).then(function(e){t.$message({type:"success",message:"操作成功!",duration:300,onClose:function(){t.saveLoading=!1,t.dialogIsOkFormVisible=!1,t.getAjaxList(),t.getStatusAjaxList()}})}):(t.$message({type:"error",message:o.msg+"''"+o.data}),t.saveLoading=!1)})}).catch(function(){e.$message({type:"info",message:"已取消"})})}},beforeMount:function(){sessionStorage.removeItem("deskId"),sessionStorage.removeItem("deskNo"),sessionStorage.removeItem("doType"),this.getAjaxList(),this.getStatusAjaxList()},created:function(){this.initWebSocket()},beforeRouteLeave:function(e,t,o){o(function(e){e.websocketclose()})}},n=(o("2gMN"),o("KHd+")),l=Object(n.a)(r,function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("section",{attrs:{id:"storeOrder"}},[o("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[o("el-breadcrumb-item",{attrs:{to:{path:"/"}}},[e._v("首页")]),e._v(" "),o("el-breadcrumb-item",[e._v("顾客订单结算管理")])],1),e._v(" "),o("el-row",{attrs:{gutter:20}},[o("el-col",{attrs:{span:18}},[o("div",{staticClass:"contentBody"},[o("div",{staticClass:"boxContent"},e._l(e.tableData,function(t){return o("div",{staticClass:"zhuotai",class:1==t.status?"self-card self-card-red":1==t.isOpen?"self-card self-card-green":"self-card self-card-gray"},[o("div",{staticStyle:{"text-align":"left",padding:"10px","box-sizing":"border-box"}},[1==t.status?o("el-button",{on:{click:function(o){return e.handelDoType(t,"zhuantai")}}},[e._v("转台")]):e._e(),e._v(" "),1==t.status?o("el-button",{on:{click:function(o){return e.handelDoType(t,"fuzhi")}}},[e._v("复制菜单")]):e._e(),e._v(" "),1==t.status?o("el-button",{staticStyle:{"margin-top":"10px"},attrs:{type:"success"},on:{click:function(o){return e.checkOut(t)}}},[e._v("结算")]):e._e(),e._v(" "),1==t.status?o("el-button",{staticStyle:{"margin-left":"0","margin-top":"10px"},on:{click:function(o){return e.handelDoType(t,"hebin")}}},[e._v("合并")]):e._e()],1),e._v(" "),o("div",{staticStyle:{height:"190px"},on:{click:function(o){return e.addOrder(t)}}},[o("div",{staticClass:"title"},[o("i",{staticClass:"largeFont"},[e._v(e._s(t.deskNo))]),e._v("号桌\n                                "),0==t.paymentStatus?o("span",{staticStyle:{"font-weight":"900"}},[e._v("（待付款）")]):e._e(),e._v(" "),1==t.paymentStatus?o("span",{staticStyle:{"font-weight":"900"}},[e._v("（顾客支付）")]):e._e(),e._v(" "),2==t.paymentStatus?o("span",{staticStyle:{"font-weight":"900"}},[e._v("（门店支付）")]):e._e()]),e._v(" "),e._l(t.orders,function(t){return o("div",{staticClass:"title"},[e._v("\n                                用餐人数："+e._s(t.people)+"，状态："+e._s(t.statusName)+"，消费总额：￥"+e._s(null==t.totalPrice?"":t.totalPrice.toFixed(2))+"\n                            ")])})],2)])}),0)])]),e._v(" "),o("el-col",{attrs:{span:6}},[o("div",{staticClass:"contentBody",staticStyle:{"max-height":"700px","overflow-y":"auto"}},[e._v("\n                待确认订单\n                "),e._l(e.statusList,function(t){return o("el-card",{staticClass:"box-card",staticStyle:{"margin-bottom":"20px"}},[o("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[o("span",[e._v("桌号："+e._s(t.deskNo))]),e._v(" "),o("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:function(o){return e.onClickQueRen(t)}}},[e._v("确认订单")])],1),e._v(" "),o("div",[o("p",[e._v("订单号："+e._s(t.orderNo))]),e._v(" "),o("p",[e._v("用餐人数："+e._s(t.people))]),e._v(" "),o("p",[e._v("总额(元)："+e._s(null==t.totalPrice?"":t.totalPrice.toFixed(2)))]),e._v(" "),o("p",[e._v("备注："+e._s(t.remark))])])])})],2)])],1),e._v(" "),o("el-dialog",{staticStyle:{width:"840px",left:"25%"},attrs:{title:e.dialogFormTitle,visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[o("el-form",{ref:"dialogForm",attrs:{model:e.dialogForm,"label-width":"120px",rules:e.rules}},[o("el-form-item",{attrs:{label:"顾客类型"}},[o("el-button",{attrs:{size:"mini",type:e.buttonPu},on:{click:function(t){return e.handleClickDetail("","","add2")}},model:{value:e.dialogForm.type,callback:function(t){e.$set(e.dialogForm,"type",t)},expression:"dialogForm.type"}},[e._v("普通结算")]),e._v(" "),o("el-button",{attrs:{size:"mini",type:e.buttonHui},on:{click:function(t){return e.handleClickDetail("","","add")}},model:{value:e.dialogForm.type,callback:function(t){e.$set(e.dialogForm,"type",t)},expression:"dialogForm.type"}},[e._v("会员结算")])],1),e._v(" "),o("el-form-item",{attrs:{label:"应收金额"}},[e._v("\n                ￥"+e._s(e.dialogForm.recPrice)+"\n            ")]),e._v(" "),o("el-form-item",{attrs:{label:"消费总金额"}},[e._v("\n                ￥"+e._s(e.dialogForm.totalPrice)+"\n            ")]),e._v(" "),o("el-form-item",{attrs:{label:"不打折金额"}},[e._v("\n                ￥"+e._s(e.dialogForm.noDiscountAmount)+"\n            ")]),e._v(" "),1==e.dialogForm.type?o("el-form-item",{attrs:{label:"选择折扣"}},[o("el-select",{attrs:{placeholder:"选择折扣"},on:{change:e.changeCount},model:{value:e.dialogForm.discount,callback:function(t){e.$set(e.dialogForm,"discount",t)},expression:"dialogForm.discount"}},e._l(e.checkOutList,function(e){return o("el-option",{attrs:{label:e.name+"折",value:e.name}})}),1)],1):e._e(),e._v(" "),2!=e.dialogForm.type?o("el-form-item",{attrs:{label:"选择支付方式",prop:"paymentMethod"}},[o("el-select",{attrs:{placeholder:"选择支付方式"},on:{change:e.changePlay},model:{value:e.dialogForm.paymentMethod,callback:function(t){e.$set(e.dialogForm,"paymentMethod",t)},expression:"dialogForm.paymentMethod"}},e._l(e.options,function(e){return o("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1):e._e(),e._v(" "),2==e.dialogForm.type?o("el-form-item",{attrs:{label:"会员折扣",prop:"name"}},[o("el-input",{staticStyle:{width:"218px"},attrs:{placeholder:"请输入",maxlength:25,disabled:""},model:{value:e.dialogForm.discount2,callback:function(t){e.$set(e.dialogForm,"discount2",t)},expression:"dialogForm.discount2"}},[e._v(e._s(e.dialogForm.discount2))])],1):e._e(),e._v(" "),2==e.dialogForm.type?o("el-form-item",{attrs:{label:"会员姓名",prop:"name"}},[o("el-input",{staticStyle:{width:"218px"},attrs:{placeholder:"请输入",maxlength:25,disabled:""},model:{value:e.dialogForm.name,callback:function(t){e.$set(e.dialogForm,"name",t)},expression:"dialogForm.name"}},[e._v(e._s(e.dialogForm.name))])],1):e._e(),e._v(" "),2==e.dialogForm.type?o("el-form-item",{attrs:{label:"会员电话",prop:"phone"}},[o("el-input",{staticStyle:{width:"218px"},attrs:{placeholder:"请输入",maxlength:25,disabled:""},model:{value:e.dialogForm.phone,callback:function(t){e.$set(e.dialogForm,"phone",t)},expression:"dialogForm.phone"}},[e._v(e._s(e.dialogForm.phone))])],1):e._e(),e._v(" "),2==e.dialogForm.type?o("div",[o("el-form-item",{attrs:{label:"选择优惠卷"}},[o("span",{staticStyle:{cursor:"pointer"},on:{click:e.checkCoupon}},[e._v("有可使用优惠卷")])])],1):e._e(),e._v(" "),2==e.dialogForm.type?o("div",[0!=e.allIntergralrule?o("el-form-item",{attrs:{label:"积分抵扣"}},[o("span",[e._v("共有"+e._s(e.allIntergralrule)+"积分,"+e._s(e.IntegralruleData.integral)+"积分抵扣"+e._s(e.IntegralruleData.amount)+"元")])]):e._e(),e._v(" "),0!=e.allIntergralrule?o("el-form-item",{attrs:{label:"是否使用"}},[o("span",[o("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949"},on:{change:e.isActive},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}})],1)]):e._e()],1):e._e(),e._v(" "),2==e.dialogForm.type?o("div",[0!=e.dialogForm.coupon?o("el-form-item",{attrs:{label:"优惠金额",prop:"phone"}},[o("span",{staticStyle:{cursor:"pointer"},domProps:{innerHTML:e._s(e.dialogForm.coupon)}})]):e._e(),e._v(" "),0!=e.goodsPrice?o("el-form-item",{attrs:{label:"菜品抵扣金额"}},[o("span",{domProps:{innerHTML:e._s(e.goodsPrice)}})]):e._e()],1):e._e(),e._v(" "),1==e.dialogForm.type?o("el-form-item",{attrs:{label:"实收金额"}},[o("el-input-number",{ref:"",attrs:{size:"medium",precision:2,min:0},model:{value:e.dialogForm.discountPrice,callback:function(t){e.$set(e.dialogForm,"discountPrice",t)},expression:"dialogForm.discountPrice"}})],1):e._e(),e._v(" "),2==e.dialogForm.type?o("el-form-item",{staticStyle:{width:"340px"},attrs:{label:"抹零金额"}},[o("el-input-number",{attrs:{min:0},on:{change:e.handleChange},model:{value:e.delPrice,callback:function(t){e.delPrice=t},expression:"delPrice"}})],1):e._e(),e._v(" "),2==e.dialogForm.type?o("el-form-item",{attrs:{label:"实收金额"}},[o("span",[e._v(e._s(e.totalPrice))])]):e._e(),e._v(" "),o("el-form-item",{staticStyle:{width:"340px"},attrs:{label:"备注"}},[o("el-input",{attrs:{type:"textarea",maxlength:200,autocomplete:"off",max:""},model:{value:e.dialogForm.remark,callback:function(t){e.$set(e.dialogForm,"remark",t)},expression:"dialogForm.remark"}})],1)],1),e._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),e._v(" "),o("el-button",{attrs:{type:"success",loading:e.ListLoading},on:{click:function(t){return e.dialogFormSubmit("budget")}}},[e._v("预结算")]),e._v(" "),o("el-button",{attrs:{type:"primary",loading:e.saveLoading},on:{click:function(t){return e.dialogFormSubmit("dialogForm")}}},[e._v("确 定")])],1)],1),e._v(" "),o("el-dialog",{attrs:{title:e.dialogTreeTitle,visible:e.dialogTreeFormVisible,width:"80%",top:"5vh"},on:{"update:visible":function(t){e.dialogTreeFormVisible=t}}},[o("el-container",[o("el-main",[o("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.searchForm,"label-width":"80px"}},[o("el-form-item",{attrs:{label:"搜索"}},[o("el-input",{attrs:{maxlength:200,autocomplete:"off",placeholder:"姓名/电话",clearable:""},model:{value:e.searchForm.username,callback:function(t){e.$set(e.searchForm,"username",t)},expression:"searchForm.username"}})],1),e._v(" "),o("el-form-item",{attrs:{"label-width":"0"}},[o("el-button",{attrs:{icon:"el-icon-search",circle:"","native-type":"submit"},nativeOn:{click:function(t){return t.preventDefault(),e.onSearch(t)}}})],1)],1),e._v(" "),o("el-table",{attrs:{data:e.tableTreeData2,border:""}},[o("el-table-column",{attrs:{align:"center","header-align":"center",type:"index",label:"行号",width:"80"}}),e._v(" "),o("el-table-column",{attrs:{align:"center","header-align":"center",prop:"name",label:"姓名",width:"120"}}),e._v(" "),o("el-table-column",{attrs:{align:"center","header-align":"center",prop:"phone",label:"电话"}}),e._v(" "),o("el-table-column",{attrs:{align:"center","header-align":"center",prop:"amount",label:"金额",width:"100"}}),e._v(" "),o("el-table-column",{attrs:{align:"center","header-align":"center",prop:"discount",label:"折扣",width:"100"}}),e._v(" "),o("el-table-column",{attrs:{align:"center","header-align":"center",prop:"customerName",label:"注册门店",width:"100"}}),e._v(" "),o("el-table-column",{attrs:{align:"center","header-align":"center",prop:"wechat",label:"微信号",width:"100"}}),e._v(" "),o("el-table-column",{attrs:{align:"center","header-align":"center",label:"操作",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(o){return e.handleClickTreeAdd2(t.$index,t.row)}}},[e._v("添加")])]}}])})],1),e._v(" "),o("el-pagination",{attrs:{background:"","current-page":e.paramTree2.pageNo,"page-size":e.paramTree2.pageSize,layout:"total,prev, pager, next",total:e.totalTreeNum2},on:{"current-change":e.handleCurrentChangeTree2,"update:currentPage":function(t){return e.$set(e.paramTree2,"pageNo",t)},"update:current-page":function(t){return e.$set(e.paramTree2,"pageNo",t)}}})],1)],1),e._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){return e.memberClick()}}},[e._v("关闭")])],1)],1),e._v(" "),o("el-dialog",{attrs:{title:"转台",visible:e.dialogZhuanTaiFormVisible,width:"30%"},on:{"update:visible":function(t){e.dialogZhuanTaiFormVisible=t}}},[o("el-form",{ref:"dialogZhuanTaiForm",attrs:{model:e.dialogZhuanTaiForm,rules:e.rules,"label-width":"120px"}},[o("el-form-item",{attrs:{label:"当前桌号"}},[e._v("\n                "+e._s(e.dialogZhuanTaiForm.oldDeskNo)+"\n            ")]),e._v(" "),o("el-form-item",{attrs:{label:"选择桌号",prop:"deskId"}},[o("el-select",{attrs:{placeholder:"请选择转到哪一桌"},model:{value:e.dialogZhuanTaiForm.deskId,callback:function(t){e.$set(e.dialogZhuanTaiForm,"deskId",t)},expression:"dialogZhuanTaiForm.deskId"}},e._l(e.tableData,function(t){return e.dialogZhuanTaiForm.oldDeskId!=t.id?o("el-option",{attrs:{label:"第"+t.deskNo+"桌",value:t.id}}):e._e()}),1)],1)],1),e._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){e.dialogZhuanTaiFormVisible=!1}}},[e._v("取 消")]),e._v(" "),o("el-button",{attrs:{type:"primary",loading:e.saveLoading},on:{click:function(t){return e.dialogZhuanTaiFormSubmit("dialogZhuanTaiForm")}}},[e._v("确 定")])],1)],1),e._v(" "),o("el-dialog",{attrs:{title:"合并",visible:e.dialogZhuanTaiFormVisible,width:"30%"},on:{"update:visible":function(t){e.dialogZhuanTaiFormVisible=t}}},[o("el-form",{ref:"dialogZhuanTaiForm",attrs:{model:e.dialogZhuanTaiForm,rules:e.rules,"label-width":"120px"}},[o("el-form-item",{attrs:{label:"当前桌号"}},[e._v("\n                "+e._s(e.dialogZhuanTaiForm.oldDeskNo)+"\n            ")]),e._v(" "),o("el-form-item",{attrs:{label:"选择桌号",prop:"deskId"}},[o("el-select",{attrs:{placeholder:"请选合并到哪一桌"},model:{value:e.dialogZhuanTaiForm.deskId,callback:function(t){e.$set(e.dialogZhuanTaiForm,"deskId",t)},expression:"dialogZhuanTaiForm.deskId"}},e._l(e.tableData,function(t){return e.dialogZhuanTaiForm.oldDeskId!=t.id?o("el-option",{attrs:{label:"第"+t.deskNo+"桌",value:t.id}}):e._e()}),1)],1)],1),e._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){e.dialogZhuanTaiFormVisible=!1}}},[e._v("取 消")]),e._v(" "),o("el-button",{attrs:{type:"primary",loading:e.saveLoading},on:{click:function(t){return e.pushOrder("dialogZhuanTaiForm")}}},[e._v("确 定")])],1)],1),e._v(" "),o("el-dialog",{attrs:{title:"复制菜单",visible:e.dialogCopyFormVisible,width:"30%"},on:{"update:visible":function(t){e.dialogCopyFormVisible=t}}},[o("el-form",{ref:"dialogCopyForm",attrs:{model:e.dialogCopyForm,rules:e.rules,"label-width":"120px"}},[o("el-form-item",{attrs:{label:"当前桌号"}},[e._v("\n                "+e._s(e.dialogCopyForm.oldDeskNo)+"\n            ")]),e._v(" "),o("el-form-item",{attrs:{label:"选择桌号",prop:"deskId"}},[o("el-select",{attrs:{placeholder:"请选择复制到哪一桌"},model:{value:e.dialogCopyForm.deskId,callback:function(t){e.$set(e.dialogCopyForm,"deskId",t)},expression:"dialogCopyForm.deskId"}},e._l(e.tableData,function(t){return e.dialogCopyForm.oldDeskId!=t.id?o("el-option",{attrs:{label:"第"+t.deskNo+"桌",value:t.id}}):e._e()}),1)],1)],1),e._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){e.dialogCopyFormVisible=!1}}},[e._v("取 消")]),e._v(" "),o("el-button",{attrs:{type:"primary",loading:e.saveLoading},on:{click:function(t){return e.dialogCopyFormSubmit("dialogCopyForm")}}},[e._v("确 定")])],1)],1),e._v(" "),o("el-dialog",{attrs:{title:"待确认订单",visible:e.dialogIsOkFormVisible,width:"50%"},on:{"update:visible":function(t){e.dialogIsOkFormVisible=t}}},[o("el-table",{attrs:{data:e.orderList}},[o("el-table-column",{attrs:{label:"名称",prop:"name",align:"center","header-align":"center"}}),e._v(" "),o("el-table-column",{attrs:{label:"数量",prop:"number",align:"center","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    x"+e._s(e.orderList[t.$index].number)+"\n                ")]}}])}),e._v(" "),o("el-table-column",{attrs:{label:"单价",prop:"price",align:"center","header-align":"center"}}),e._v(" "),o("el-table-column",{attrs:{prop:"totalPrice",label:"总价",align:"center","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(e.orderList[t.$index].number*e.orderList[t.$index].price)+"\n                ")]}}])}),e._v(" "),o("el-table-column",{attrs:{label:"口味",prop:"flavor",align:"center","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(e.orderList[t.$index].flavor)+"\n                ")]}}])}),e._v(" "),o("el-table-column",{attrs:{label:"单品备注",prop:"remark",align:"center","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(e.orderList[t.$index].remark)+"\n                ")]}}])}),e._v(" "),o("el-table-column",{attrs:{label:"是否免费",align:"center","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                   "+e._s(0==e.orderList[t.$index].isFree?"是":"否")+"\n                ")]}}])})],1),e._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){e.dialogIsOkFormVisible=!1}}},[e._v("取 消")]),e._v(" "),o("el-button",{attrs:{type:"primary",loading:e.saveLoading},on:{click:e.dialogIsOkFormSubmit}},[e._v("确 定")])],1)],1),e._v(" "),o("el-dialog",{attrs:{title:"选择优惠卷",visible:e.dialogCoupon,width:"30%"},on:{"update:visible":function(t){e.dialogCoupon=t}}},[o("div",{staticClass:"coupon-box"},e._l(e.couponData,function(t,a){return o("div",{key:a,staticClass:"coupon-list"},[o("div",{staticClass:"coupon-left"},[o("span",[e._v("￥"+e._s(t.couponAmount))]),e._v(" "),o("span",[e._v("抵用卷")])]),e._v(" "),o("div",{staticClass:"coupon-center"},[o("h3",[e._v(e._s(t.couponName))]),e._v(" "),o("p",[e._v("有效期至:"+e._s(t.couponEndTime))])]),e._v(" "),o("div",{staticClass:"coupon-right"},[o("div",{staticClass:"check"},[o("el-checkbox",{attrs:{disabled:t.isPrice},on:{change:function(o){return e.checkCoupondata(t,a)}}},[e._v("选择")])],1)])])}),0),e._v(" "),o("div",{staticClass:"footer"},[o("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.confrimCoupon()}}},[e._v("确认")])],1)])],1)},[],!1,null,null,null);l.options.__file="order.vue";t.default=l.exports}}]);